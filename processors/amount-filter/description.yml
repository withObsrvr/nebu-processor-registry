processor:
  name: amount-filter
  type: transform
  description: Filter token transfer events by amount (min/max thresholds)
  version: 1.0.0
  language: Go
  license: MIT
  maintainers:
    - withObsrvr

repo:
  github: withObsrvr/nebu
  ref: main

docs:
  quick_start: |
    # Install the processor
    nebu install amount-filter

    # Filter for transfers over 1M stroops (10 XLM)
    token-transfer --start-ledger 60200000 | amount-filter --min 1000000

    # Filter for specific range
    token-transfer --start-ledger 60200000 | amount-filter --min 100000 --max 10000000

  examples: |
    # Track large USDC transfers (>$1000)
    token-transfer --start-ledger 60200000 --follow | \
      usdc-filter | \
      amount-filter --min 10000000 | \
      json-file-sink --out large-usdc.jsonl

    # Track whale movements (>100 XLM)
    token-transfer --start-ledger 60200000 --follow | \
      amount-filter --min 1000000000 | \
      nats-sink --subject "whales.transfers"

    # Track micro-payments
    token-transfer --start-ledger 60200000 | \
      amount-filter --max 10000 | \
      jq -c '{amount, asset: .transfer.assetCode}'

  extended_description: |
    Amount Filter Transform Processor

    Filters token transfer events based on transfer amount, allowing you to track
    large transfers (whale movements), small transfers (micropayments), or transfers
    within a specific range.

    **What it does:**
    - Reads JSON events from stdin
    - Filters based on transfer amount (in stroops/smallest unit)
    - Supports min threshold, max threshold, or both
    - Writes filtered events to stdout
    - Preserves all event metadata

    **Configuration:**
    - `--min`: Minimum amount (inclusive), in stroops
    - `--max`: Maximum amount (inclusive), in stroops
    - `-q, --quiet`: Suppress startup banner

    **Amount Units:**
    All amounts are in stroops (1 XLM = 10,000,000 stroops).
    For USDC: 1 USDC = 10,000,000 stroops.

    **Use Cases:**
    - Track whale movements (large transfers)
    - Monitor micropayments
    - Alert on transfers above threshold
    - Filter out dust amounts

    **Best Practices:**
    - Convert from XLM to stroops: 1 XLM = 10^7 stroops
    - Combine with usdc-filter for asset-specific thresholds
    - Use with dedup to avoid counting the same transfer twice
